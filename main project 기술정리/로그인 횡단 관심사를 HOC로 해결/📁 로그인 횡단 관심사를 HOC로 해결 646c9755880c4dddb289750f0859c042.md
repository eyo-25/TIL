# ğŸ“ ë¡œê·¸ì¸ íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¥¼ HOCë¡œ í•´ê²°

## ë¬¸ì œ ì¸ì‹

---

React Router Dom v6.4ì˜ createBrowserRouter ì‚¬ìš©í•˜ì—¬ ë¼ìš°íŒ… ì²˜ë¦¬í•˜ë˜ ì¤‘ ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì— ì ‘ì†í–ˆì„ë•Œ ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ ë©”ì¸ í˜ì´ì§€ë¡œ ëŒë ¤ë³´ë‚´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

ì²˜ìŒì—ëŠ” í•´ë‹¹ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ì—ì„œ useEffectë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ë©”ì¸ í˜ì´ì§€ë¡œ ë³´ë‚´ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆì§€ë§Œ, **ì´ë¡œ ì¸í•´ í˜ì´ì§€ê°€ ì ê¹ ë³´ì˜€ë‹¤ê°€ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” í˜„ìƒì´ ë°œìƒí•˜ê³  ëª¨ë“  ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ì´ ë¡œì§ì„ ì¤‘ë³µí•´ì„œ ì‘ì„±í•´ì•¼ í•˜ëŠ” ë¬¸ì œ**ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

```jsx
// client/src/pages/MyPage.tsx

...

function MyPage() {
	useEffect(() => {
    const accessToken = storage.get('accessToken');
    if (!accessToken) {
      navigate('/users/login');
    }
  }, [navigate]);

	...
}
```

## **íš¡ë‹¨ ê´€ì‹¬ì‚¬(Cross-cutting Concerns)**

---

ìœ„ì—ì„œ ë§í•œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ê³¼ ê°™ì€ ê³µí†µì ì¸ ê´€ì‹¬ì‚¬ë¥¼ íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¼ê³  í•©ë‹ˆë‹¤.

íš¡ë‹¨ ê´€ì‹¬ì‚¬ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ ì—¬ëŸ¬ ëª¨ë“ˆì´ë‚˜ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê³µí†µìœ¼ë¡œ ë°œìƒí•˜ëŠ” ê¸°ëŠ¥ ë˜ëŠ” ë¡œì§ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì—¬ëŸ¬ ë¶€ë¶„ì— ê±¸ì³ ìˆê¸° ë•Œë¬¸ì— "íš¡ë‹¨"í•˜ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë¡œê¹…, ë³´ì•ˆ, ì¸ì¦, íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë“±ì´ íš¡ë‹¨ ê´€ì‹¬ì‚¬ì— í•´ë‹¹í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê´€ì‹¬ì‚¬ë“¤ì€ ì—¬ëŸ¬ ê³³ì—ì„œ ì¤‘ë³µë˜ëŠ” ì½”ë“œë¥¼ ë‚³ì„ ìˆ˜ ìˆìœ¼ë©°, ë³€ê²½ ì‚¬í•­ì„ ë°˜ì˜í•˜ê¸° ì–´ë µê³  ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## **ê³ ì°¨ ì»´í¬ë„ŒíŠ¸(Higher-Order Component)**

---

ìœ„ì˜ íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ ê³ ì°¨ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ëŠ” ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ë°›ì•„ë“¤ì—¬ ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì´ë¡œì¨ ì»´í¬ë„ŒíŠ¸ì˜ ë¡œì§ì„ ì¬ì‚¬ìš©í•˜ê³ , ì½”ë“œ ì¤‘ë³µì„ ì¤„ì´ë©°, íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ì—¬ ë‹¤ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ëŠ” ì£¼ë¡œ ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ë¡œì§ì„ ìº¡ìŠí™”í•˜ê³  ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

## createBrowserRouter

---

[https://reactrouter.com/en/main/routers/create-browser-router](https://reactrouter.com/en/main/routers/create-browser-router)

createBrowserRouterì˜ ê¸°ë³¸ ì‚¬ìš©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```jsx
...

const router = createBrowserRouter([
  {
    path: "/",
    element: <Root />,
    loader: rootLoader,
    children: [
      {
        path: "team",
        element: <Team />,
        loader: teamLoader,
      },
    ],
  },
]);

ReactDOM.createRoot(document.getElementById("root")).render(
  <RouterProvider router={router} />
);
```

## router ì„¤ì •

---

ìš°ë¦¬ëŠ” ë£¨íŠ¸ ê²½ë¡œì˜ childrenì— í•„ìš”í•œ routerë¥¼ ìœ„ì™€ ê°™ì´ ë“±ë¡í•©ë‹ˆë‹¤. ì´ë•Œ elementì— ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê²½ë¡œì¸ <AuthRoute>ì™€ ë¡œê·¸ì¸ì´ í•„ìš”í•˜ì§€ ì•ŠëŠ” <PublicRoute>ì˜ ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ í•´ë‹¹í˜ì´ì§€ë¥¼ ë Œë”ë§í•˜ì—¬ ë¡œê·¸ì¸ì´ í•„ìš”í•œ ë¼ìš°íŠ¸ì— ì ‘ì†ì‹œ AuthRouteë‚´ì—ì„œ ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë³´ë‚´ë„ë¡ í•©ë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ì„œëŠ” childrenì— ë“¤ì–´ê°€ëŠ” router[]ì¸ routerDataë¥¼ ë¯¸ë¦¬ ì •ì˜ í•´ë‘ê³  withAuthë¼ëŠ” booleanì„ í†µí•´ ë¡œê·¸ì¸ì´ í•„ìš”í•œ ë¼ìš°í„°ì¸ì§€ ì•„ë‹Œì§€ë¥¼ ì„¤ì •í•˜ê³  ë¼ìš°í„°ì„¤ì •ì‹œ í•´ë‹¹ routerDataë¥¼ mapí•˜ë©´ì„œ withAuthê°€ trueë©´ <AuthRoute>ì„ ì•„ë‹ˆë¼ë©´ <PublicRoute>ì„ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

```jsx
interface Router {
  path: string;
  element: React.ReactNode;
  withAuth: boolean;
}

const routerData: Router[] = [
	...
  {
    index: true,
    path: '/category?/:categoryId?',
    element: <MainPage />,
    withAuth: false,
  },
  {
    path: '/mypage',
    element: <MyPage />,
    withAuth: true,
  },
	...
];
```

```jsx

const router = createBrowserRouter([
  {
    path: '/',
    element: <Root />,
    children: routerData.map((router) => {
      if (router.withAuth) {
        return {
          path: router.path,
          element: <AuthRoute>{router.element}</AuthRoute>,
        };
      } else {
        return {
          path: router.path,
          element: <PublicRoute>{router.element}</PublicRoute>,
        };
      }
    }),
  },
]);

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
    <Provider store={store}>
      <RouterProvider router={router} />
    </Provider>
);
```

## AuthRoute

---

ì´ ì»´í¬ë„ŒíŠ¸ëŠ” ì¸ì¦ê³¼ ê´€ë ¨ëœ íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¥¼ ë‹¤ë£¨ëŠ” ê³³ì…ë‹ˆë‹¤. í˜ì´ì§€ ì ‘ê·¼ ì‹œ ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ , í•„ìš”í•œ ê²½ìš° ìë™ ë¡œê·¸ì¸ì„ ì‹œë„í•˜ì—¬ ì¸ì¦ëœ ì‚¬ìš©ìì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì¦‰ ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ì˜ ì›ë¦¬ë¥¼ í™œìš©í•œ ì˜ˆì‹œë¡œ, í˜ì´ì§€ ë¡œë”© ì „ì— í•„ìš”í•œ ì¸ì¦ ë¡œì§ì„ ì²˜ë¦¬í•˜ê³  í˜ì´ì§€ì˜ **`children`** ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.

ë¨¼ì € ë¦¬ë•ìŠ¤ë¥¼ í†µí•´ isLoginì„ í™•ì¸í•´ì„œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸ í•©ë‹ˆë‹¤. ë§Œì•½ ë¡œê·¸ì¸ëœ ê²½ìš° í† í°ì„ í†µí•´ ë¡œê·¸ì¸ì„ í™•ì¸í•˜ê³  ìœ ì €ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê¸° ìœ„í•´ì„œ ì…ë‹ˆë‹¤.

```jsx
const isLogin = useAppSelector((state) => state.user.isLogin);
```

ë¡œê·¸ì¸ì´ ì•ˆëœê²½ìš° ì•¡ì„¸ìŠ¤ í† í°ì„ í™•ì¸í•˜ê³  í† í°ì„ ìˆë‹¤ë©´ ìœ ì €ì •ë³´ë¥¼ ë°›ì•„ì˜¤ê³  ì•„ë‹ˆë¼ë©´ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ë¥¼ í•˜ê³  ë¡œê·¸ì¸í˜ì´ì§€ë¡œ ë³´ëƒ…ë‹ˆë‹¤.

```jsx
    if (!isLogin) {
      const accessToken = storage.get('accessToken');
      if (accessToken) {
        getUser();
      } else {
        logOut();
        navigate('/users/login');
      }
    }
```

í•´ë‹¹ë¡œì§ì€ AuthRouteê°€ ë§ˆìš´íŠ¸ë˜ë©´ useEffectë¥¼ í†µí•´ autoLoginì´ ì‹¤í–‰ë˜ë©° ë¡œê·¸ì¸ì´ í•„ìš”í•œ ë¼ìš°íŠ¸ì—ì„œëŠ” ëª¨ë‘ ì‚¬ìš©í•˜ë¯€ë¡œ autoLoginí•¨ìˆ˜ëŠ” useCallbackì„ í†µí•´ ìµœì í™” í•´ì¤ë‹ˆë‹¤.

```jsx
  const autoLogin = useCallback(() => {
    if (!isLogin) {
      const accessToken = storage.get('accessToken');
      if (accessToken) {
        getUser();
      } else {
        logOut();
        navigate('/users/login');
      }
    }
    setIsLoading(true);
  }, []);

  useEffect(() => {
    autoLogin();
  }, []);
```

## ë§ˆë¬´ë¦¬

---

![banner-image.jpg](%F0%9F%93%81%20%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%92%E1%85%AC%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%B5%E1%86%B7%E1%84%89%E1%85%A1%E1%84%85%E1%85%B3%E1%86%AF%20HOC%E1%84%85%E1%85%A9%20%E1%84%92%E1%85%A2%E1%84%80%E1%85%A7%E1%86%AF%20646c9755880c4dddb289750f0859c042/banner-image.jpg)

ì´ë¡œ ì¸í•´ ì‚¬ìš©ì í”¼ë“œë°±ì—ì„œ ë¶ˆí¸í•¨ì´ ì—†ì—ˆë‹¤ëŠ” ì ê³¼ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œë¥¼ ê¹”ë”í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë˜í•œ ì´ ê²½í—˜ì„ í†µí•´ í‰ì†Œì—ë„ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë¡œì§ê³¼ ì»´í¬ë„ŒíŠ¸ì˜ ê´€ì‹¬ì‚¬ë¥¼ ì˜ ë¶„ë¥˜í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë Œë”ë§ì´ë‚˜ ì½”ë“œ ì¤‘ë³µì„ ì¤„ì—¬ì•¼ í•œë‹¤ëŠ” ê¹¨ë‹¬ìŒì„ ì–»ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```jsx
...

type Props = {
  children: ReactNode;
};

const AuthRoute = ({ children }: Props) => {
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const navigate = useNavigate();
  const dispatch = useAppDispatch();
  const isLogin = useAppSelector((state) => state.user.isLogin);

  const getUser = async () => {
    const userInfo = await getUserInfo();
    dispatch(userSlice.actions.logIn(userInfo));
    setIsLoading(true);
  };

  const autoLogin = useCallback(() => {
    if (!isLogin) {
      const accessToken = storage.get('accessToken');
      if (accessToken) {
        getUser();
      } else {
        logOut();
        navigate('/users/login');
      }
    }
    setIsLoading(true);
  }, []);

  useEffect(() => {
    autoLogin();
  }, []);

  if (!isLoading) return <>Loading...</>;

  return isLoading ? <>{children}</> : <Navigate to='/users/login' />;
};

export default AuthRoute;
```