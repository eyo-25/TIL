# 🔒️ HTTPS

## HTTPS의 개념

---

HTTPS는 Hyper Text Transfer Protocol Secure의 약자로, 인터넷을 통해 데이터를 안전하게 전송하기 위한 프로토콜입니다. HTTPS는 HTTP와 달리, 암호화된 SSL/TLS(보안 소켓 레이어/전송 계층 보안) 프로토콜을 사용하여 데이터를 전송합니다.

HTTPS를 사용하는 경우, 클라이언트와 **서버 간의 통신은 암호화**되어 있어 누군가가 데이터를 도청하더라도 데이터의 내용을 알 수 없습니다. 또한 HTTPS는 인증서를 사용하여 **서버의 신원을 검증**하므로, 중간자 공격(MITM)과 같은 공격을 방지할 수 있습니다.

즉 HTTPS의 장점은 아래와 같다.

1. 내가 사이트에 보내는 정보들을 제 3자가 못보게 한다.
2. 접속한 사이트가 믿을 만한 곳인지를 알려준다.

## 대칭키 / 비대칭키

---

데이터를 암호화를 할 때에는 암호화할 때 사용할 키, 암호화한 것을 해석(복호화)할 때 사용할 키가 필요합니다. 이때 암호화와 복호화할 때 사용하는 키가 동일하다면 대칭 키 암호화 방식, 다르다면 공개 키(비대칭 키) 암호화 방식이라고 합니다.

## 🔑 대칭키 (하나의 키)

![CV.JPG](%F0%9F%94%92%EF%B8%8F%20HTTPS%200a94c6604ae64def8c3291cfdbd67f56/CV.jpg)

대칭키는 암호화와 복호화에 동일한 키를 사용하는 방식입니다. 즉, 데이터를 암호화할 때 사용하는 키와 데이터를 복호화할 때 사용하는 키가 같습니다. 이러한 대칭키 방식은 암호화 및 복호화 속도가 빠르다는 장점이 있습니다.

하지만 같은 키를 사용하기 때문에 키를 주고받는 과정에서 탈취당했을 경우에는 암호화가 소용없어지기 때문에 보안이 취약해질 수 있습니다.

## 🔑 비대칭키 (공개 키, 비밀 키)

![ZXCSC.JPG](%F0%9F%94%92%EF%B8%8F%20HTTPS%200a94c6604ae64def8c3291cfdbd67f56/ZXCSC.jpg)

비대칭 키 암호화 방식은 **두 개**의 키를 사용합니다. 암호화할 때 사용한 키와 다른 키로만 복호화가 가능합니다.

여기서 두 개의 키를 각각 **공개 키**, **비밀 키**라고 부릅니다. 여기서 공개 키는 이름 그대로 공개되어 있기 때문에 누구든지 접근 가능합니다. 누구든 이 공개 키를 사용해서 암호화한 데이터를 보내면, 비밀 키를 가진 사람만 그 내용을 복호화할 수 있습니다.

보통 요청을 보내는 사용자가 공개 키를, 요청을 받는 서버가 비밀 키를 가집니다. 이때, 비밀 키는 서버가 해킹당하는 게 아닌 이상 탈취되지 않습니다.

> **이제 공개키를 통해 개인정보를 보낼때 비밀키를 가진 서버에서만 정보를 복호화할 수 있기때문에 서버에게 안전하게 전송가능하다!**
> 

하지만, 비대칭키 방식은 **대칭키 방식에 비해 암호화 및 복호화 속도가 느리다**는 단점이 있습니다.

따라서 보통 대칭키와 비대칭키를 조합하여 사용하여, 대칭키로 데이터를 암호화한 후, 비대칭키로 대칭키를 암호화하여 전송하고, 수신측에서는 비대칭키로 대칭키를 복호화하고, 대칭키로 데이터를 복호화하는 방식이 사용됩니다.

## ****SSL/TLS 프로토콜****

---

HTTPS는 HTTP 통신을 하는 소켓 부분에서 SSL 혹은 TLS라는 프로토콜을 사용하여 서버 인증과 데이터 암호화를 진행합니다. 여기서 SSL이 표준화되며 바뀐 이름이 TLS이므로 사실상 같은 프로토콜이라고 생각하시면 됩니다.

SSL/TLS는 다음과 같은 특징을 가집니다.

- **CA**를 통한 **인증서** 사용
- **대칭 키, 공개 키 암호화 방식을 모두 사용**

## 암호화 수행과정

---

암호화 수행과정은 크게 인증서 확인과 대칭 키 전달 두가지 과정으로 이루어 집니다.

### 인증서 확인

HTTPS를 사용하면 브라우저가 서버의 응답과 함께 전달된 **인증서**를 확인할 수 있습니다. 이러한 인증서는 서버의 신원을 보증해 줍니다. 이때 **인증서를 발급해 주는 공인된 기관**들을 Certificate Authority, **CA**라고 부릅니다.

1. 서버는 인증서를 발급받기 위해서 CA로 서버의 정보와 공개 키를 전달합니다. CA는 서버의 공개 키와 정보를 CA의 비밀 키로 암호화하여 인증서를 발급해 서버에게 전달합니다.
    
    

![_gnfy_vBHd_l0f-1_rZul-1661314141607.gif](%F0%9F%94%92%EF%B8%8F%20HTTPS%200a94c6604ae64def8c3291cfdbd67f56/_gnfy_vBHd_l0f-1_rZul-1661314141607.gif)

1. 클라이언트가 서버에 접속을 시도하면, 서버는 클라이언트에게 자신의 인증서를 제공합니다.
    
    이때, 사용자가 사용하는 브라우저는 CA들의 리스트와 공개 키를 내장하고 있습니다. 우선 해당 인증서가 리스트에 있는 CA가 발급한 인증서인지 확인하고, 리스트에 있는 CA라면 해당하는 CA의 공개 키를 사용해서 인증서의 복호화를 시도합니다.
    

1. CA의 **비밀 키**로 암호화된 데이터(인증서)는 CA의 **공개 키**로만 복호화가 가능하므로, 정말로 CA에서 발급한 인증서가 맞다면 복호화가 성공적으로 진행되어야 합니다.

- 복호화가 **성공**적으로 진행된다면, 클라이언트는 서버의 정보와 공개 키를 얻게 됨과 동시에 해당 서버가 신뢰할 수 있는 서버임을 알 수 있게 됩니다.
    
    
- 복호화가 **실패**한다면, 이는 서버가 보내준 인증서가 신뢰할 수 없는 인증서임을 확인하게 됩니다.

![uMsbO1DLi7E1jkbJUsct--1661314145125.gif](%F0%9F%94%92%EF%B8%8F%20HTTPS%200a94c6604ae64def8c3291cfdbd67f56/uMsbO1DLi7E1jkbJUsct--1661314145125.gif)

### 대칭키 전달

이제 사용자는 서버의 인증서를 성공적으로 복호화하여 서버의 공개 키를 확보했습니다. 그럼 이 공개 키를 사용해서 데이터를 암호화하여 요청과 응답을 주고받게 될까요?

안타깝게도, 이 공개 키는 해당 용도로는 사용할 수 없습니다. 공개 키 암호화 방식은 보안은 확실하지만, 복잡한 연산이 필요하여 더 많은 시간을 소모합니다. 따라서 모든 요청에서 공개 키 암호화 방식을 사용하는 것은 효율이 좋지 않습니다.

그렇다면 이 공개 키는 어디에 쓰는 걸까요? 바로 클라이언트와 서버가 함께 사용하게 될 **대칭 키를 주고받을 때** 쓰게 됩니다. 대칭 키는 속도는 빠르지만, 오고 가는 과정에서 탈취될 수 있다는 위험성이 있었습니다.

하지만 클라이언트가 서버로 대칭 키를 보낼 때 서버의 공개 키를 사용해서 암호화하여 보내준다면, 서버의 비밀 키를 가지고 있는 게 아닌 이상 해당 대칭 키를 복호화할 수 없으므로 탈취될 위험성이 줄어듭니다.

![yhUfQWzMVhzNas7hsJxsj-1661314146961.gif](%F0%9F%94%92%EF%B8%8F%20HTTPS%200a94c6604ae64def8c3291cfdbd67f56/yhUfQWzMVhzNas7hsJxsj-1661314146961.gif)

1. 클라이언트는 데이터를 암호화하여 **주고받을 때 사용할 대칭 키를 생성**합니다.

1. 클라이언트는 생성한 대칭 키를 서버의 공개 키로 암호화하여 전달합니다.

1. 서버는 전달받은 데이터를 비밀 키로 복호화하여 대칭 키를 확보합니다. 이렇게 서버와 클라이언트는 동일한 대칭 키를 갖게 되었습니다.

## 요약

---

![UZG0EGjvRv4b_tFwZMANv-1661314148539.gif](%F0%9F%94%92%EF%B8%8F%20HTTPS%200a94c6604ae64def8c3291cfdbd67f56/UZG0EGjvRv4b_tFwZMANv-1661314148539.gif)

이제 HTTPS 요청을 주고받을 때 이 대칭 키를 사용하여 데이터를 암호화하여 빠르게 전달하게 됩니다.

하지만 대칭 키 자체는 오고 가지 않기 때문에 키가 유출될 위험이 없어졌습니다. 따라서 요청이 중간에 탈취되어도 제3자가 암호화된 데이터를 복호화할 수 없게 됩니다.

HTTPS는 이러한 암호화 과정을 통해 HTTP보다 안전하게 요청과 응답을 주고받을 수 있게 해 줍니다.

정리하자면, 이렇게 서버와 클라이언트 간의 CA를 통해 서버를 인증하는 과정과 데이터를 암호화하는 과정을 아우르는 프로토콜을 SSL 또는 TLS이라고 말하고, **HTTP에 SSL/TLS 프로토콜을 더한 것을 HTTPS라고 합니다.**